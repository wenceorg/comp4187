<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Measuring point-to-point message latency with ping-pong #  In this exercise we will write a simple code that does a message ping-pong: sending a message back and forth between two processes.
We can use this to measure both the latency and bandwidth of the network on our supercomputer. Which are both important measurements when we&rsquo;re looking at potential parallel performance: they help us to decide if our code is running slowly because of our bad choices, or limitations in the hardware."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Ping-pong latency"><meta property="og:description" content="Measuring point-to-point message latency with ping-pong #  In this exercise we will write a simple code that does a message ping-pong: sending a message back and forth between two processes.
We can use this to measure both the latency and bandwidth of the network on our supercomputer. Which are both important measurements when we&rsquo;re looking at potential parallel performance: they help us to decide if our code is running slowly because of our bad choices, or limitations in the hardware."><meta property="og:type" content="article"><meta property="og:url" content="https://teaching.wence.uk/comp4187/exercises/parallel/pingpong/"><meta property="article:modified_time" content="2024-02-14T14:35:09+00:00"><title>Ping-pong latency | COMP4187 – Parallel Scientific Computing II</title><link rel=manifest href=/comp4187/manifest.json><link rel=icon href=/comp4187/favicon.png type=image/x-icon><link rel=stylesheet href=/comp4187/book.min.0cb0b7d6a1ed5d0e95321cc15edca4d6e9cc406149d1f4a3f25fd532f6a3bb38.css integrity="sha256-DLC31qHtXQ6VMhzBXtyk1unMQGFJ0fSj8l/VMvajuzg="><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true}]})});</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><div class=book-brand><img class=book-center src=/comp4187/logo.svg alt=Logo><h2><a href=/comp4187>COMP4187 – Parallel Scientific Computing II</a></h2></div><ul><li><span>Administrivia</span><ul><li><a href=/comp4187/setup/jupyter/>Jupyter</a></li><li><a href=/comp4187/setup/mpi/>MPI</a></li></ul></li><li><span>Exercises</span><ul><li><span>Parallel</span><ul><li><a href=/comp4187/exercises/parallel/hello/>Parallel Hello World</a></li><li><a href=/comp4187/exercises/parallel/pi/>Calculating π</a></li><li><a href=/comp4187/exercises/parallel/domain-decomp-simple/>1-D domain decomposition</a></li><li><a href=/comp4187/exercises/parallel/pingpong/ class=active>Ping-pong latency</a></li></ul></li><li><a href=/comp4187/exercises/coarse-grid/>Coarse Grid Operator</a></li><li><a href=/comp4187/exercises/finite-differences/>Finite Differences</a></li><li><a href=/comp4187/exercises/two-grid/>Two-Grid Iteration</a></li><li><a href=/comp4187/exercises/norms/>Norms</a></li></ul></li><li><span>Notes</span><ul><li><span>Lectures: Numerics</span><ul><li><a href=/comp4187/lectures/numerics/lecture1/>Lecture 1: Time-stepping</a></li><li><a href=/comp4187/lectures/numerics/lecture2/>Lecture 2: Time-stepping</a></li><li><a href=/comp4187/lectures/numerics/lecture3/>Lecture 3: Time-stepping</a></li><li><a href=/comp4187/lectures/numerics/lecture4/>Lecture 4: Finite Differences</a></li><li><a href=/comp4187/lectures/numerics/lecture5/>Lecture 5: Finite Differences</a></li><li><a href=/comp4187/lectures/numerics/lecture6/>Lecture 6: Finite Differences</a></li><li><a href=/comp4187/lectures/numerics/lecture7/>Lecture 7: Linear Solvers</a></li><li><a href=/comp4187/lectures/numerics/lecture8/>Lecture 8: Linear Solvers</a></li><li><a href=/comp4187/lectures/numerics/lecture9/>Lecture 9: Multigrid</a></li></ul></li><li><a href=/comp4187/lectures/mpi/>MPI</a><ul><li><a href=/comp4187/lectures/mpi/point-to-point/>Point-to-point messaging in MPI</a></li><li><a href=/comp4187/lectures/mpi/point-to-point-nb/>Non-blocking point-to-point messaging</a></li><li><a href=/comp4187/lectures/mpi/collectives/>Collectives</a></li><li><a href=/comp4187/lectures/mpi/advanced/>Advanced topics</a></li><li><a href=/comp4187/lectures/mpi/petsc4py/>PETSc and petsc4py</a></li><li><a href=/comp4187/lectures/mpi/live-notes/>Term 2: live lecture notes</a></li></ul></li></ul></li><li><a href=/comp4187/coursework/>Coursework 1: Euler-Bernoulli Beam Theory</a></li><li><a href=/comp4187/coursework2/>Coursework 2: multigrid solvers</a></li><li><a href=/comp4187/acknowledgements/>Acknowledgements</a></li><li><span>Past editions</span><ul><li><span>2020/21</span><ul><li><a href=/comp4187/past-editions/2020-21/term1/>Term 1: numerics</a></li><li><a href=/comp4187/past-editions/2020-21/term2/>Term 2: parallel computing</a></li><li><a href=/comp4187/past-editions/2020-21/coursework/>Coursework: a 3D multigrid solver</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/comp4187/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Ping-pong latency</strong>
<label for=toc-control><img src=/comp4187/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#measuring-point-to-point-message-latency-with-ping-pong>Measuring point-to-point message latency with ping-pong</a><ul><li><a href=#a-model-for-the-time-to-send-a-message>A model for the time to send a message</a></li><li><a href=#implementation>Implementation</a></li><li><a href=#experiment>Experiment</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=measuring-point-to-point-message-latency-with-ping-pong>Measuring point-to-point message latency with ping-pong
<a class=anchor href=#measuring-point-to-point-message-latency-with-ping-pong>#</a></h1><p>In this exercise we will write a simple code that does a message
ping-pong: sending a message back and forth between two processes.</p><p>We can use this to measure both the <em>latency</em> and <em>bandwidth</em> of the
network on our supercomputer. Which are both important measurements
when we&rsquo;re looking at potential parallel performance: they help us to
decide if our code is running slowly because of our bad choices, or
limitations in the hardware.</p><h2 id=a-model-for-the-time-to-send-a-message>A model for the time to send a message
<a class=anchor href=#a-model-for-the-time-to-send-a-message>#</a></h2><p>We care about the total time it takes to send a message, our model is
a linear model which has two free parameters:</p><ol><li>$\alpha$, the message latency, measured in seconds;</li><li>$\beta$, the inverse network bandwidth, measured in seconds/byte
(so that the bandwidth is $\beta^{-1}$.</li></ol><p>With this model, the time to send a message with $b$ bytes is</p><p>$$
T(b) = \alpha + \beta b
$$</p><h2 id=implementation>Implementation
<a class=anchor href=#implementation>#</a></h2><p>In the lectures, we wrote some code to do this in
<a href=https://teaching.wence.uk/comp4187/code/parallel/live/pingpong.py><code>code/parallel/live/pingpong.py</code></a>.</p><p>We need to run it with at least two processes, but you can run it in
serial with <code>-h</code> to see what options it takes</p><pre><code>$ python pingpong.py -h
usage: pingpong.py [-h] [--use-pickle] output_file

positional arguments:
  output_file   Write data to specified numpy file (load with numpy.load)

optional arguments:
  -h, --help    show this help message and exit
  --use-pickle  Send messages using pickle interface?
                If False (default), send numpy buffers
</code></pre><p>When running, it prints some progress information about the size of
message it&rsquo;s sending to the screen and writes an output file of the
timing data in a format suitable for loading by
<a href=https://numpy.org/doc/stable/reference/generated/numpy.load.html><code>numpy.load</code></a>.
You can then load this and produce a plot with
<a href=https://matplotlib.org>matplotlib</a>.</p><h2 id=experiment>Experiment
<a class=anchor href=#experiment>#</a></h2><blockquote class=exercise><h3>Exercise</h3><span><p>Run the code using two processes on your own machine (or Hamilton
using a single node).</p><p>It will save the measured times in a commandline-specified file.</p><p>Produce a plot of the data, and try and fit the linear model to it.
What do you get for your values of $\alpha$ and $\beta$.</p><p>If you perform the same experiment using both the numpy interface for
sending data and the pickle interface (selected with the
<code>--use-pickle</code> argument), do you observe a difference in the
performance?</p><p>If yes, why do you think this might be? Recall that in the pickle
interface, mpi4py must first convert the buffer into its pickled form.
Is this free? Does this change the size of the buffer?</p></span></blockquote><blockquote class=question><h3>Question</h3><span><p>Perform the same experiment, but this time, place the two processes on
<em>different</em> Hamilton compute nodes. Do you observe a difference in the
performance?</p><p>To do this, you&rsquo;ll need to write a SLURM batch script that specifies</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-sh data-lang=sh><span style=color:#75715e># Two nodes</span>
<span style=color:#75715e>#SBATCH --nodes=2</span>
<span style=color:#75715e># One process per node</span>
<span style=color:#75715e>#SBTACH --ntasks-per-node=1</span>
</code></pre></div></span></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/wenceorg/comp4187/commit/9271858aa631161252031b9cd38d4da1c5c802a0 title="Last modified by Lawrence Mitchell | February 14, 2024" target=_blank rel=noopener><img src=/comp4187/svg/calendar.svg class=book-icon alt=Calendar>
<span>February 14, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/wenceorg/comp4187/edit/main/site/content/exercises/parallel/pingpong.md target=_blank rel=noopener><img src=/comp4187/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><div class="flex flex-wrap align-right"><p>© 2020&ndash; <a href=mailto:lawrence@wence.uk>Lawrence Mitchell</a>, <a href=https://annereinarz.github.io>Anne Reinarz</a> & <a href=https://www.dur.ac.uk/>Durham University</a>.</p><p><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=/comp4187/cc-by-sa.svg></a>
This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Creative
Commons Attribution-ShareAlike 4.0 International License</a>.</p></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#measuring-point-to-point-message-latency-with-ping-pong>Measuring point-to-point message latency with ping-pong</a><ul><li><a href=#a-model-for-the-time-to-send-a-message>A model for the time to send a message</a></li><li><a href=#implementation>Implementation</a></li><li><a href=#experiment>Experiment</a></li></ul></li></ul></nav></aside></main></body></html>